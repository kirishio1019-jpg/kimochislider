<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>フェルミ推定：論理的思考のインタラクティブ・ガイド</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #fafaf9; /* stone-50 */
            color: #44403c; /* stone-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .step-card.active {
            border-color: #d97706; /* amber-600 */
            background-color: #fffbeb; /* amber-50 */
        }
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }
        input[type=range]:focus {
            outline: none; 
        }
    </style>
    <!-- Chosen Palette: Warm Neutrals (Stone base) with Amber/Emerald Accents for a calm, academic yet engaging feel. -->
    <!-- Application Structure Plan: 
         1. Hero Section: Introduces the concept "What is Fermi Estimation?" emphasizing the "Process > Answer" philosophy.
         2. Process Explorer: An interactive 4-step wizard. Users click through the steps (Goal, Model, Calc, Verify) to understand the workflow detailed in the report.
         3. Simulation Lab (Starbucks Case): The core interactive component. Transforms the static math example into a dynamic calculator. Users adjust variables (Population, Usage Rate, etc.) via sliders to see how the estimate changes compared to the "Actual" range using a real-time Chart.js visualization. This teaches "Sensitivity Analysis".
         4. Success Tactics: A grid of the 5 tips/tricks for quick consumption.
         5. The Challenge (Pencil Case): An active learning section where users draft their own model for the "Pencil Consumption" problem before revealing hints, encouraging application of learned concepts.
    -->
    <!-- Visualization & Content Choices: 
         - Intro: Icon-based cards for clear definition.
         - Process: Tabbed interface to reduce cognitive load, showing one step detail at a time.
         - Starbucks Sim: Bar Chart (Chart.js) to compare "User Estimate" vs "Actual Reality". This provides immediate feedback on the "Accuracy" of the estimate. Interaction via sliders allows users to feel the impact of each variable.
         - Challenge: Progressive disclosure (Accordion/Hidden Text) for hints to prevent spoilers.
         - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
</head>
<body class="bg-stone-50 text-stone-800 antialiased">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-stone-50/90 backdrop-blur-md border-b border-stone-200 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="font-bold text-xl tracking-tight text-stone-900">Fermi<span class="text-amber-600">Lab</span></div>
                <div class="hidden md:flex space-x-8 text-sm font-medium text-stone-600">
                    <a href="#intro" class="hover:text-amber-600 transition">基本概念</a>
                    <a href="#process" class="hover:text-amber-600 transition">4つのステップ</a>
                    <a href="#simulation" class="hover:text-amber-600 transition">実践シミュレーション</a>
                    <a href="#challenge" class="hover:text-amber-600 transition">演習問題</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero / Definition Section -->
    <section id="intro" class="py-16 sm:py-24 px-4 bg-white">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-stone-900 mb-6 tracking-tight">
                答えのない問いに、<br><span class="text-amber-600">論理</span>で挑む。
            </h1>
            <p class="text-lg sm:text-xl text-stone-600 mb-12 max-w-2xl mx-auto leading-relaxed">
                実際に測定することが難しい量を、手持ちの知識と論理的思考で概算する技術。<br>
                それが<strong>フェルミ推定</strong>です。
            </p>

            <!-- 3 Pillars Grid -->
            <div class="grid md:grid-cols-3 gap-8 text-left">
                <div class="p-6 bg-stone-50 rounded-xl border border-stone-100 shadow-sm hover:shadow-md transition">
                    <div class="text-3xl mb-4">🧠</div>
                    <h3 class="font-bold text-lg mb-2">思考力を試す</h3>
                    <p class="text-sm text-stone-600">正確な答えよりも、そこに辿り着くまでの「プロセス」と「論理構築力」が評価されます。</p>
                </div>
                <div class="p-6 bg-stone-50 rounded-xl border border-stone-100 shadow-sm hover:shadow-md transition">
                    <div class="text-3xl mb-4">🏗️</div>
                    <h3 class="font-bold text-lg mb-2">前提を立てる</h3>
                    <p class="text-sm text-stone-600">情報の不足を嘆くのではなく、根拠のある「仮説」を設定し、前に進む力を養います。</p>
                </div>
                <div class="p-6 bg-stone-50 rounded-xl border border-stone-100 shadow-sm hover:shadow-md transition">
                    <div class="text-3xl mb-4">🔢</div>
                    <h3 class="font-bold text-lg mb-2">数字感覚を磨く</h3>
                    <p class="text-sm text-stone-600">桁間違いを防ぎ、世の中の事象を定量的に捉える「概算能力」をトレーニングします。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- The 4 Steps Process -->
    <section id="process" class="py-16 px-4 bg-stone-100">
        <div class="max-w-5xl mx-auto">
            <div class="mb-10 text-center">
                <h2 class="text-3xl font-bold text-stone-900">フェルミ推定の標準的4ステップ</h2>
                <p class="text-stone-600 mt-2">このフレームワークに沿って思考を展開します。各ステップをクリックして詳細を確認しましょう。</p>
            </div>

            <div class="grid md:grid-cols-12 gap-6">
                <!-- Step Navigation -->
                <div class="md:col-span-4 flex flex-col space-y-3">
                    <button onclick="setStep(1)" id="btn-step-1" class="step-card active text-left p-4 rounded-lg border border-stone-200 bg-white shadow-sm transition hover:bg-stone-50 focus:outline-none">
                        <span class="text-xs font-bold text-stone-400 uppercase tracking-wider">Step 1</span>
                        <div class="font-bold text-stone-800 text-lg">ゴール設定と前提</div>
                    </button>
                    <button onclick="setStep(2)" id="btn-step-2" class="step-card text-left p-4 rounded-lg border border-stone-200 bg-white shadow-sm transition hover:bg-stone-50 focus:outline-none">
                        <span class="text-xs font-bold text-stone-400 uppercase tracking-wider">Step 2</span>
                        <div class="font-bold text-stone-800 text-lg">モデル構築</div>
                    </button>
                    <button onclick="setStep(3)" id="btn-step-3" class="step-card text-left p-4 rounded-lg border border-stone-200 bg-white shadow-sm transition hover:bg-stone-50 focus:outline-none">
                        <span class="text-xs font-bold text-stone-400 uppercase tracking-wider">Step 3</span>
                        <div class="font-bold text-stone-800 text-lg">計算実行</div>
                    </button>
                    <button onclick="setStep(4)" id="btn-step-4" class="step-card text-left p-4 rounded-lg border border-stone-200 bg-white shadow-sm transition hover:bg-stone-50 focus:outline-none">
                        <span class="text-xs font-bold text-stone-400 uppercase tracking-wider">Step 4</span>
                        <div class="font-bold text-stone-800 text-lg">検証と調整</div>
                    </button>
                </div>

                <!-- Step Content Display -->
                <div class="md:col-span-8 bg-white p-8 rounded-2xl shadow-lg border border-stone-200 relative overflow-hidden min-h-[300px]">
                    <div id="step-content-1" class="step-content animate-fade-in">
                        <h3 class="text-2xl font-bold text-amber-600 mb-4">質問の分解と前提の明確化</h3>
                        <p class="mb-4 text-stone-700 leading-relaxed">
                            まずは「何を推定するか（ゴール）」を明確にし、その答えを導くために必要な要素へ質問を分解します。
                        </p>
                        <div class="bg-stone-50 p-4 rounded border-l-4 border-amber-500 mb-4">
                            <p class="font-bold text-sm text-stone-500 mb-1">例：日本に電柱は何本あるか？</p>
                            <ul class="list-disc list-inside text-stone-700 space-y-1">
                                <li>日本の総面積は？</li>
                                <li>人口密度は？</li>
                                <li>道路の総延長は？</li>
                            </ul>
                        </div>
                        <p class="text-sm text-stone-500">初期仮説（前提）を設定し、あやふやな定義を固定することが最初の重要なタスクです。</p>
                    </div>
                    
                    <div id="step-content-2" class="step-content hidden animate-fade-in">
                        <h3 class="text-2xl font-bold text-amber-600 mb-4">計算式の作成（モデル化）</h3>
                        <p class="mb-4 text-stone-700 leading-relaxed">
                            分解した要素を使って、最終的な答えを導くための論理的な計算式を組み立てます。モデルはシンプルであることが重要です。
                        </p>
                        <div class="bg-stone-50 p-4 rounded border-l-4 border-amber-500 mb-4">
                            <p class="font-bold text-sm text-stone-500 mb-1">モデル構築の例</p>
                            <p class="font-mono text-stone-800">
                                総電柱数 = (都市部の電柱数) + (郊外の電柱数)
                            </p>
                        </div>
                        <p class="text-sm text-stone-500">複雑すぎるモデルは計算ミスの元凶です。論理的な繋がりを意識しましょう。</p>
                    </div>

                    <div id="step-content-3" class="step-content hidden animate-fade-in">
                        <h3 class="text-2xl font-bold text-amber-600 mb-4">数値の代入と計算</h3>
                        <p class="mb-4 text-stone-700 leading-relaxed">
                            自分の知識や常識（日本の人口約1.2億人、など）から具体的な概算値を代入し、計算を実行します。
                        </p>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-red-50 p-3 rounded text-center">
                                <span class="block text-red-500 font-bold mb-1">⚠️ 注意</span>
                                <span class="text-xs text-red-700">大きな数字の桁間違いに気をつける</span>
                            </div>
                            <div class="bg-green-50 p-3 rounded text-center">
                                <span class="block text-green-600 font-bold mb-1">💡 コツ</span>
                                <span class="text-xs text-green-800">109,500 → 110,000のように簡略化する</span>
                            </div>
                        </div>
                    </div>

                    <div id="step-content-4" class="step-content hidden animate-fade-in">
                        <h3 class="text-2xl font-bold text-amber-600 mb-4">リアリティチェック</h3>
                        <p class="mb-4 text-stone-700 leading-relaxed">
                            算出された数字が「常識的にあり得る範囲か」を検証します。
                        </p>
                        <ul class="space-y-2 text-stone-700">
                            <li class="flex items-start">
                                <span class="mr-2 text-amber-500">✔</span>
                                <span>結果が直感と大きくズレていないか？</span>
                            </li>
                            <li class="flex items-start">
                                <span class="mr-2 text-amber-500">✔</span>
                                <span>別の切り口（人口ベースではなく面積ベースなど）で検算可能か？</span>
                            </li>
                            <li class="flex items-start">
                                <span class="mr-2 text-amber-500">✔</span>
                                <span>前提条件の甘さを認識し、誤差の要因を説明できるか？</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Simulation Lab -->
    <section id="simulation" class="py-16 px-4 bg-white border-t border-stone-200">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-12">
                <span class="bg-amber-100 text-amber-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">Practice Case</span>
                <h2 class="text-3xl sm:text-4xl font-bold text-stone-900 mt-4">東京にあるスターバックスの店舗数は？</h2>
                <p class="text-stone-600 mt-4 max-w-2xl mx-auto">
                    レポートの実践例である「店舗密度アプローチ（人口ベース）」をシミュレーターにしました。<br>
                    各パラメータ（前提）を動かして、推定値がどう変化するか体感してください。
                </p>
            </div>

            <div class="grid lg:grid-cols-2 gap-12 items-start">
                
                <!-- Controls -->
                <div class="bg-stone-50 p-6 sm:p-8 rounded-2xl shadow-inner border border-stone-200">
                    <h3 class="text-xl font-bold text-stone-800 mb-6 border-b border-stone-200 pb-2">前提パラメータの調整</h3>
                    
                    <!-- Formula Display -->
                    <div class="bg-white p-4 rounded-lg shadow-sm mb-8 overflow-x-auto">
                        <p class="text-xs text-stone-500 font-bold uppercase mb-2">計算モデル</p>
                        <div class="font-mono text-sm sm:text-base text-stone-800 whitespace-nowrap">
                            店舗数 = <span class="text-blue-600">(人口 × 利用率 × 頻度)</span> ÷ <span class="text-red-600">(1店舗客数 × 365)</span>
                        </div>
                    </div>

                    <div class="space-y-8">
                        <!-- Input: Population -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <label class="text-sm font-bold text-stone-700">東京23区の人口 (P)</label>
                                <span class="text-sm font-mono text-blue-600" id="val-pop">900万人</span>
                            </div>
                            <input type="range" id="input-pop" min="500" max="1400" value="900" step="10" 
                                   class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            <p class="text-xs text-stone-400 mt-1">範囲: 500万〜1400万人</p>
                        </div>

                        <!-- Input: Usage Rate -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <label class="text-sm font-bold text-stone-700">利用者の割合 (R)</label>
                                <span class="text-sm font-mono text-blue-600" id="val-rate">5%</span>
                            </div>
                            <input type="range" id="input-rate" min="1" max="20" value="5" step="0.5" 
                                   class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            <p class="text-xs text-stone-400 mt-1">範囲: 1%〜20% (日常的に利用する人)</p>
                        </div>

                        <!-- Input: Frequency -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <label class="text-sm font-bold text-stone-700">年間利用回数 (F)</label>
                                <span class="text-sm font-mono text-blue-600" id="val-freq">50回/年</span>
                            </div>
                            <input type="range" id="input-freq" min="10" max="150" value="50" step="5" 
                                   class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            <p class="text-xs text-stone-400 mt-1">週1回=約50回</p>
                        </div>

                        <!-- Input: Capacity -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <label class="text-sm font-bold text-stone-700">1店舗の客数/日 (C)</label>
                                <span class="text-sm font-mono text-red-600" id="val-cap">300人</span>
                            </div>
                            <input type="range" id="input-cap" min="100" max="800" value="300" step="10" 
                                   class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-red-600">
                            <p class="text-xs text-stone-400 mt-1">平日・休日平均</p>
                        </div>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="flex flex-col h-full">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-stone-200 flex-grow flex flex-col items-center justify-center text-center mb-6">
                        <p class="text-stone-500 font-medium mb-2">推計結果</p>
                        <div class="text-6xl font-bold text-stone-900 mb-2" id="result-display">205</div>
                        <p class="text-stone-400 text-sm">店舗</p>
                    </div>

                    <!-- Chart Container -->
                    <div class="bg-white p-4 rounded-2xl shadow border border-stone-200">
                        <h4 class="text-sm font-bold text-stone-700 mb-4 text-center">推計値 vs 実際の範囲（目安）</h4>
                        <div class="chart-container">
                            <canvas id="starbucksChart"></canvas>
                        </div>
                        <p class="text-xs text-stone-400 mt-4 text-center">
                            ※実際の23区内店舗数は約250〜300店舗程度と言われています。<br>
                            あなたの前提（左側の設定）は現実と比べてどうですか？
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Success Tips -->
    <section id="tips" class="py-16 px-4 bg-stone-900 text-stone-100">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold mb-10 text-center">成功のための5つのポイント</h2>
            <div class="grid md:grid-cols-5 gap-4">
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700 hover:bg-stone-700 transition duration-300 transform hover:-translate-y-1">
                    <div class="text-amber-500 font-bold text-lg mb-2">01</div>
                    <h3 class="font-bold mb-2">分解しすぎない</h3>
                    <p class="text-xs text-stone-400 leading-relaxed">最初はシンプルに。モデルが複雑になればなるほど、計算ミスのリスクが高まります。</p>
                </div>
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700 hover:bg-stone-700 transition duration-300 transform hover:-translate-y-1">
                    <div class="text-amber-500 font-bold text-lg mb-2">02</div>
                    <h3 class="font-bold mb-2">計算を単純化</h3>
                    <p class="text-xs text-stone-400 leading-relaxed">365日≒360日、109,500≒11万のように、概算に適した数字に丸めて計算しましょう。</p>
                </div>
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700 hover:bg-stone-700 transition duration-300 transform hover:-translate-y-1">
                    <div class="text-amber-500 font-bold text-lg mb-2">03</div>
                    <h3 class="font-bold mb-2">前提の言語化</h3>
                    <p class="text-xs text-stone-400 leading-relaxed">なぜその数字（例：利用率5%）を選んだのか？根拠を必ず言葉にして説明しましょう。</p>
                </div>
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700 hover:bg-stone-700 transition duration-300 transform hover:-translate-y-1">
                    <div class="text-amber-500 font-bold text-lg mb-2">04</div>
                    <h3 class="font-bold mb-2">複数の切り口</h3>
                    <p class="text-xs text-stone-400 leading-relaxed">余裕があれば、「人口ベース」だけでなく「面積ベース」など別の視点でも試してみましょう。</p>
                </div>
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700 hover:bg-stone-700 transition duration-300 transform hover:-translate-y-1">
                    <div class="text-amber-500 font-bold text-lg mb-2">05</div>
                    <h3 class="font-bold mb-2">自信を持つ</h3>
                    <p class="text-xs text-stone-400 leading-relaxed">正解はありません。あなたの思考プロセスとロジックを堂々と伝えましょう。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Challenge Section -->
    <section id="challenge" class="py-16 px-4 bg-amber-50">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white p-8 sm:p-12 rounded-3xl shadow-xl border border-amber-100 text-center">
                <div class="inline-block bg-amber-100 p-3 rounded-full mb-6">
                    <span class="text-3xl">✏️</span>
                </div>
                <h2 class="text-3xl font-bold text-stone-900 mb-6">Your Turn: 演習問題</h2>
                <p class="text-xl font-medium text-stone-700 mb-8">
                    「日本全国で、年間どれくらいの<br>
                    <span class="text-amber-600 font-bold bg-amber-100 px-2 rounded">鉛筆</span>が消費されているでしょうか？」
                </p>

                <div class="text-left bg-stone-50 p-6 rounded-xl border border-stone-200 mb-8">
                    <label class="block text-sm font-bold text-stone-500 mb-2">あなたの思考プロセス（メモ欄）</label>
                    <textarea class="w-full h-32 p-4 rounded-lg border border-stone-300 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 bg-white resize-none" placeholder="ここをクリックして、モデル分解や計算のメモを書いてみましょう..."></textarea>
                </div>

                <div class="space-y-4">
                    <button onclick="toggleHint()" class="bg-stone-800 hover:bg-stone-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform active:scale-95">
                        ヒントを見る / 隠す
                    </button>
                    
                    <div id="hint-box" class="hidden text-left bg-blue-50 p-6 rounded-xl border border-blue-100 mt-6 animate-fade-in">
                        <h4 class="font-bold text-blue-800 mb-3">思考のヒント：分解のアプローチ</h4>
                        <ul class="space-y-2 text-stone-700 text-sm">
                            <li><strong>1. 対象者のセグメンテーション：</strong> 日本人全員が同じように鉛筆を使うでしょうか？（小学生 vs 大人）</li>
                            <li><strong>2. 消費量の推定：</strong> 小学生は1ヶ月に何本消費しますか？大人は年間で何本ですか？</li>
                            <li><strong>3. 在庫や法人需要：</strong> 個人消費以外に、オフィスや学校での備品としての需要はありますか？</li>
                            <li><strong>4. 計算モデル例：</strong> (小学生人口 × 消費数) + (中高生人口 × 消費数) + (大人人口 × 消費数)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-stone-100 py-8 text-center text-stone-400 text-sm border-t border-stone-200">
        <p>Generated based on Fermi Estimation Slides</p>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- Step Tab Logic ---
        function setStep(stepNum) {
            // Update Buttons
            document.querySelectorAll('.step-card').forEach(btn => {
                btn.classList.remove('active', 'border-amber-600', 'bg-amber-50');
            });
            document.getElementById(`btn-step-${stepNum}`).classList.add('active');

            // Update Content with simple fade effect
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.add('hidden');
            });
            const content = document.getElementById(`step-content-${stepNum}`);
            content.classList.remove('hidden');
        }

        // --- Challenge Hint Toggle ---
        function toggleHint() {
            const hintBox = document.getElementById('hint-box');
            hintBox.classList.toggle('hidden');
        }

        // --- Simulation Logic (Starbucks) ---
        
        // Initial State
        const state = {
            pop: 900, // 10k unit (900 = 9,000,000)
            rate: 5,  // %
            freq: 50, // times/year
            cap: 300  // persons/day
        };

        let chartInstance = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            updateSimulation();

            // Event Listeners
            document.getElementById('input-pop').addEventListener('input', (e) => {
                state.pop = parseInt(e.target.value);
                document.getElementById('val-pop').textContent = state.pop + "万人";
                updateSimulation();
            });
            document.getElementById('input-rate').addEventListener('input', (e) => {
                state.rate = parseFloat(e.target.value);
                document.getElementById('val-rate').textContent = state.rate + "%";
                updateSimulation();
            });
            document.getElementById('input-freq').addEventListener('input', (e) => {
                state.freq = parseInt(e.target.value);
                document.getElementById('val-freq').textContent = state.freq + "回/年";
                updateSimulation();
            });
            document.getElementById('input-cap').addEventListener('input', (e) => {
                state.cap = parseInt(e.target.value);
                document.getElementById('val-cap').textContent = state.cap + "人";
                updateSimulation();
            });
        });

        function calculateStores() {
            // Model: (Pop * Rate * Freq) / (Cap * 365)
            // Units: Pop is in 10,000s. So 900 -> 9,000,000
            const P = state.pop * 10000;
            const R = state.rate / 100;
            const F = state.freq;
            const C = state.cap;

            const totalVisits = P * R * F;
            const capacityPerYear = C * 365;
            
            // Avoid division by zero
            if(capacityPerYear === 0) return 0;

            return Math.round(totalVisits / capacityPerYear);
        }

        function initChart() {
            const ctx = document.getElementById('starbucksChart').getContext('2d');
            
            // Comparison Data: Actual is approx 250-300 in 23 wards
            // We represent this as a range visually using two bars or a background annotation.
            // For simplicity in a bar chart: [User Estimate, Actual Low, Actual High]
            
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['あなたの推計値', '実際の店舗数 (目安)'],
                    datasets: [{
                        label: '店舗数',
                        data: [0, 275], // 275 is midpoint of 250-300
                        backgroundColor: [
                            'rgba(217, 119, 6, 0.8)', // Amber
                            'rgba(120, 113, 108, 0.3)' // Stone
                        ],
                        borderColor: [
                            'rgb(217, 119, 6)',
                            'rgb(120, 113, 108)'
                        ],
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.dataIndex === 1) {
                                        return "約 250〜300 店舗";
                                    }
                                    return context.raw + " 店舗";
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f5f5f4' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    animation: {
                        duration: 500
                    }
                }
            });
        }

        function updateSimulation() {
            const result = calculateStores();
            
            // Text Update
            document.getElementById('result-display').textContent = result;

            // Chart Update
            if (chartInstance) {
                chartInstance.data.datasets[0].data[0] = result;
                chartInstance.update();
            }
        }

    </script>
</body>
</html>








